
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>大海Online的博客</title>
  <meta name="author" content="lianghaijun">

  
  <meta name="description" content="
  
  
    
    
      
  
    
      maven jetty 配置
    
    
      
        










      
    
  


  jetty的maven插件配置(pom.xml)


  scanInterv...">
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.lianghaijun.com/page/7/">
  <link href="/blog/static/screen.css" media="screen, projection" rel="stylesheet">
  <link href="" rel="alternate" title="大海Online的博客" type="application/atom+xml">
</head>

<body   >
  <header role="banner"><hgroup>
  <div id="wb_connect_btn"></div>
  <h1><a href="/">大海Online的博客</a></h1>
  
    <h2>Looking for Interest</h2>
  
</hgroup>
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/blog/archives.html">Archives</a></li>
  <li><a href="/blog/link.html">link</a></li>
  <li><a href="/blog/about.html">about</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-10-02-1689147.html">maven jetty 配置</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-10-02T10:48:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p><em>jetty的maven插件配置(pom.xml)</em></p>

<ul>
  <li>scanIntervalSeconds 配置扫描时间时间, 如果有文件变动, 如pom.xml,web.xml或classes, 则jetty会重新加载应用, 相当方便</li>
  <li>contextPath 配置ROOT, 即将web的上下文路径, 改为 /</li>
  <li>将jetty默认的uri编码, 改为GBK   (jetty默认是utf8)</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span> 
    <span class="nt">&lt;groupId&gt;</span>org.mortbay.jetty<span class="nt">&lt;/groupId&gt;</span> 
    <span class="nt">&lt;artifactId&gt;</span>maven-jetty-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;configuration&gt;</span>    
        <span class="nt">&lt;contextPath&gt;</span>/<span class="nt">&lt;/contextPath&gt;</span>    
        <span class="nt">&lt;connectors&gt;</span>    
            <span class="nt">&lt;connector</span> <span class="na">implementation=</span><span class="s">"org.mortbay.jetty.nio.SelectChannelConnector"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;port&gt;</span>8080<span class="nt">&lt;/port&gt;</span>    
            <span class="nt">&lt;/connector&gt;</span>    
        <span class="nt">&lt;/connectors&gt;</span>    
        <span class="nt">&lt;reload&gt;</span>automatic<span class="nt">&lt;/reload&gt;</span>  
        <span class="nt">&lt;scanIntervalSeconds&gt;</span>3<span class="nt">&lt;/scanIntervalSeconds&gt;</span>
        <span class="nt">&lt;systemProperties&gt;</span>
            <span class="nt">&lt;systemProperty&gt;</span>
	        <span class="nt">&lt;name&gt;</span>org.mortbay.util.URI.charset<span class="nt">&lt;/name&gt;</span>
	        <span class="nt">&lt;value&gt;</span>GBK<span class="nt">&lt;/value&gt;</span>
	    <span class="nt">&lt;/systemProperty&gt;</span>
	 <span class="nt">&lt;/systemProperties&gt;</span>
     <span class="nt">&lt;/configuration&gt;</span> 
<span class="nt">&lt;/plugin&gt;</span>
</code></pre>
</div>

<p><em>jetty的另一段配置</em>(修改web.xml)
用于解决使用jetty后无法修改文件问题(错误描述:请求的操作无法在使用用户映射区域打开的文件上执行)</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>default<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.mortbay.jetty.servlet.DefaultServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
        <span class="nt">&lt;param-name&gt;</span>useFileMappedBuffer<span class="nt">&lt;/param-name&gt;</span>
        <span class="nt">&lt;param-value&gt;</span>false<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;load-on-startup&gt;</span>0<span class="nt">&lt;/load-on-startup&gt;</span>
<span class="nt">&lt;/servlet&gt;</span>
</code></pre>
</div>

<p><em>修改mvn时的java运行时参数</em> (解决 PermGen space问题)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>set MAVEN_OPTS=-XX:MaxPermSize=128M
mvn jetty:run
</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-09-19-1681794.html">判断两个字符串的相似度(js)</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-09-19T20:48:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>问题来源于 http://weibo.com/1748374882/yavpCkc31</p>

<p>问题：有两个字符串 A 和 B，如何简单高效的判断 A 和 B 的相似度？A 和 B 完全一样，相似度为 100, A 和 B 完全不一样，相似度为 0. A 和 B 中有一半文字相同，相似度为 50. 依此类推。文字中包含中英文，空白字符也算。哪位用 JS 挑战下？性能第一，代码长短无所谓。</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">compare</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">y</span><span class="p">.</span><span class="nx">length</span><span class="p">;;</span>

	<span class="nx">x</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
	<span class="nx">y</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
	<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

	<span class="k">while</span><span class="p">(</span><span class="nx">a</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">z</span><span class="o">++</span><span class="p">;</span>
			<span class="nx">a</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
			<span class="nx">b</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">a</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">b</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">z</span><span class="o">/</span><span class="nx">s</span> <span class="o">*</span> <span class="mi">200</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">]))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">].</span><span class="nx">sort</span><span class="p">()))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">].</span><span class="nx">reverse</span><span class="p">()))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">,</span><span class="s1">'中2文'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'12'</span><span class="p">,</span> <span class="s1">'中2文'</span><span class="p">,</span> <span class="s1">'123'</span><span class="p">,</span><span class="s1">'中文3'</span><span class="p">]))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">,</span> <span class="s1">'456'</span><span class="p">]))</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">compare</span><span class="p">([</span><span class="s1">'123'</span><span class="p">,</span> <span class="s1">'中3文'</span><span class="p">,</span> <span class="s1">'hello'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'中文'</span><span class="p">,</span> <span class="s1">'world'</span><span class="p">,</span> <span class="s1">'汉字'</span><span class="p">]))</span>
</code></pre>
</div>
</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-09-12-1676290.html">js的简单串行加载方案</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-09-12T00:29:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>写了一个超简单的串行加载工具, 不想引入框架时, 可以试用下</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">all</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">callee</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">;</span>
	<span class="nx">all</span><span class="p">.</span><span class="nx">shift</span><span class="p">()(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">callee</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">all</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
	<span class="p">});</span>
<span class="p">})([</span>
	<span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;first'</span><span class="p">;</span>

			<span class="nx">next</span><span class="p">();</span>
		<span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;second'</span><span class="p">;</span>

			<span class="nx">next</span><span class="p">();</span>
		<span class="p">},</span> <span class="mi">2000</span><span class="p">)</span>
	<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">'&lt;li&gt;third'</span><span class="p">;</span>

		<span class="p">},</span> <span class="mi">3000</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">]);</span>


</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-07-22-1603820.html">parseURL</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-07-22T23:00:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>我们知道, 在location对象中, 可以直接获取 hostname, search , hash 等参数
而链接的url中, 我们没有现成的API可以获取这些参数
下面是一个小方法, 可以得到链接中的各种参数</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">parseURL</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">ret</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">([^\/</span><span class="sr">:</span><span class="se">]</span><span class="sr">+:</span><span class="se">)?(?:\/\/([^\/</span><span class="sr">:</span><span class="se">]</span><span class="sr">*</span><span class="se">)(?:</span><span class="sr">:</span><span class="se">([\d]</span><span class="sr">+</span><span class="se">))?)?(\/?[^\?</span><span class="sr">#</span><span class="se">]</span><span class="sr">*</span><span class="se">)?(\?[^\#]</span><span class="sr">*</span><span class="se">)?(</span><span class="sr">#.*</span><span class="se">)?</span><span class="sr">$/i</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">isValid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">port</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">port</span> <span class="p">?</span> <span class="s1">':'</span> <span class="p">:</span> <span class="s1">''</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">port</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"/"</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">origin</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">host</span> <span class="p">?</span> <span class="s1">'//'</span> <span class="p">:</span> <span class="s1">''</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">isValid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="nx">ret</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-06-29-1570934.html">硬盘里还能存点啥?</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-06-29T13:21:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>网速越来越快了, 需要存硬盘的东西越来越少了</p>

<ul>
  <li>电影      没必要下载电影了, 随时随地观看在线电影,直播电视, 怀旧连续剧等   (pplive,youku)</li>
  <li>音乐      在线音乐,在线播放列表,在线mv,最新最热歌曲,各类频道  (ting, yinyuetai)</li>
  <li>电子书    不必把大量的电子书, 存放在硬盘里, 多是看一遍后, 就存下来了, 以后就很少翻了, 看着4.5个G的电子书, 删也不是, 不删也不是, 还是网络共享下, 大家共同学习.  (w3school, open开源文档)</li>
  <li>书签      浏览器的书签,没必要备份在本地了, 也没有必要换电脑或重装系统时备份了,     (chrome书签同步)</li>
  <li>安装程序  自己本地有个5G的TDDownload, 发现这些安装程序, 很少用, 且版本总是很旧, 或者多版本共存,该整理下了,换软件管理吧      (360软件管家)</li>
  <li>代码      自己的代码 or 别人的代码,还是用版本控制吧     (github,googlecode)</li>
  <li>工具包    java的jar包吗?  用maven吧,只记录地址    (maven)</li>
  <li>文档      自己的一些文档,压缩一下备份在网络上     (各类网盘)</li>
  <li>笔记      一些小碎文字,如cdkey,桌面上的小心得     (云笔记)</li>
  <li>游戏      小游戏,flash游戏,在线游戏等,  如果网络够快,将来的大型网游,也可随时下载</li>
  <li>驱动      驱动一般都有地方下载,如果用书签就更好了 (mydrivers 或 官网吧)</li>
  <li>其它      如各类backup, 等…</li>
</ul>

<p>细数下来
* 硬盘的功能, 越来越像一个cache了, 程序的cache,数据的cache,只是做个中转.   ]* 硬盘大小不够时,可以随时删除,随时从服务端再获取
* 将来我们的电脑,会不会就像ipad一样
    1. 在线商店里, 双击某个应用, 开始自动安装
    2. 自动将程序装在 D:\program files\
    3. 自动将数据装在 D:\Users\xx\Application Data , 并自动服务端同步
    4. 然后, 打开应用, 正常使用
    5. 使用过程中, 将配置,数据自动同步,  某些cache,找个大盘自动cache
    6. 不需要理会装在哪里,不需要理会数据备份问题,都由软件来解决吧
* 这个就是传说中的app模式, ipad, 360桌面, Q+, win8, 似乎都有这个意向…</p>

<p>还有哪些会存在硬盘里呢:</p>

<ol>
  <li>个人私密文档,私密照片,不适宜共享   (包括私密电影?)</li>
  <li>超大文件,   下载起来费事, 如游戏客户端,大型软件安装程序</li>
  <li>其它</li>
</ol>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-06-07-1553882.html">mini javascript loader</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-06-07T00:56:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>[size=medium]
自己写的一个mini 且 simple 的 javascript loader</p>

<p>功能特点</p>

<ul>
  <li>异步并行载入js, 每个js只加载一次</li>
  <li>支持模块依赖, 未检测循环依赖</li>
  <li>支持别名</li>
  <li>兼容ie6+ , firefox, chrome …</li>
  <li>API :<br />
 define.alias[‘modName’] = ‘http://path/to/mods/root/dir’
 define(deps, callback)   其中 callback(dep1, dep2, dep3…)
 require(deps, callback)   其中 callback(dep1, dep2, dep3…)</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="nx">define</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	
	<span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="kd">var</span> <span class="nx">modulesCallbacks</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="kd">var</span> <span class="nx">alias</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">alias</span> <span class="o">||</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">arr</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">isString</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'string'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">isArray</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'[object Array]'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'function'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">mix</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">dst</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">dst</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">src</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">dst</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">getScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
		<span class="nx">node</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">node</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">node</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">'loaded'</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">'complete'</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">node</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

		<span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">head</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'head'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
		<span class="nx">head</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">head</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getCurrentScript</span><span class="p">()</span> <span class="p">{</span>
		
		<span class="c1">//firefox4 and opera</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentScript</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">currentScript</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">//ie6-9 得到当前正在执行的script标签</span>
			<span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s1">'interactive'</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="c1">// 参考 https://github.com/samyk/jiagra/blob/master/jiagra.js</span>
			<span class="c1">// chrome and firefox4以前的版本</span>
			<span class="kd">var</span> <span class="nx">stack</span><span class="p">;</span>
			<span class="k">try</span> <span class="p">{</span>
				<span class="nx">makeReferenceError</span>
			<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">stack</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">stack</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
			<span class="c1">// chrome uses at, ff uses @</span>

			<span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">' at '</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">?</span> <span class="s1">' at '</span> <span class="p">:</span> <span class="s1">'@'</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="nx">stack</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">stack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">stack</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">stack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/:</span><span class="se">\d</span><span class="sr">+:</span><span class="se">\d</span><span class="sr">+$/ig</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">src</span> <span class="o">===</span> <span class="nx">stack</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getScriptWithCache</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scripts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_scripts</span> <span class="o">||</span> <span class="p">{};</span>
		<span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">cache</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">();</span>
			<span class="k">return</span> <span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">cache</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">cache</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
			<span class="k">return</span> <span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">scripts</span> <span class="o">=</span> <span class="p">[</span><span class="nx">callback</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="nx">getScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">scripts</span> <span class="o">||</span> <span class="p">[];</span>
			<span class="nx">scripts</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">]();</span>
			<span class="p">}</span>
		<span class="p">});</span>		
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getModule</span><span class="p">(</span><span class="nx">mod</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">modules</span><span class="p">[</span><span class="nx">mod</span><span class="p">])</span> <span class="p">{</span>
			<span class="nx">modulesCallbacks</span><span class="p">[</span><span class="nx">mod</span><span class="p">]</span> <span class="o">=</span> <span class="nx">modulesCallbacks</span><span class="p">[</span><span class="nx">mod</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
			<span class="nx">modulesCallbacks</span><span class="p">[</span><span class="nx">mod</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

			<span class="nx">getScriptWithCache</span><span class="p">(</span><span class="nx">mod</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">modules</span><span class="p">[</span><span class="nx">mod</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">getModules</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">mods</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">mods</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">();</span>
			<span class="k">return</span> <span class="p">;</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="nx">map</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mod</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">getModule</span><span class="p">(</span><span class="nx">mod</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">ret</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">c</span> <span class="o">==</span> <span class="nx">mods</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">define</span><span class="p">(</span><span class="nx">deps</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isString</span><span class="p">(</span><span class="nx">deps</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">deps</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">callback</span> <span class="o">=</span> <span class="nx">deps</span><span class="p">;</span>
			<span class="nx">deps</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">getCurrentScript</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">current</span> <span class="o">&amp;&amp;</span> <span class="nx">current</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>

		<span class="nx">deps</span> <span class="o">=</span> <span class="nx">deps</span> <span class="o">||</span> <span class="p">[];</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">isString</span><span class="p">(</span><span class="nx">deps</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">deps</span> <span class="o">=</span> <span class="nx">deps</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">','</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">allDeps</span> <span class="o">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">deps</span><span class="p">,</span> <span class="nx">tran</span><span class="p">);</span>				<span class="c1">//全部转换映射</span>

		<span class="nx">getModules</span><span class="p">(</span><span class="nx">allDeps</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mods</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">isFunction</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">?</span> <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">mods</span><span class="o">||</span><span class="p">[])</span> <span class="p">:</span> <span class="nx">callback</span><span class="p">;</span>
			<span class="nx">modules</span> <span class="o">=</span> <span class="nx">modules</span> <span class="o">||</span> <span class="p">{}</span>
			<span class="nx">mix</span><span class="p">(</span><span class="nx">modules</span><span class="p">,</span> <span class="nx">ret</span><span class="p">);</span>

			<span class="nx">container</span> <span class="o">!=</span> <span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">mix</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">ret</span><span class="p">));</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">modulesCallbacks</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">modulesCallbacks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">modulesCallbacks</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">ret</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">});</span>

		<span class="k">return</span> <span class="nx">container</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">tran</span><span class="p">(</span><span class="nx">dep</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">dep</span> <span class="o">=</span> <span class="nx">dep</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'^'</span> <span class="o">+</span> <span class="nx">key</span><span class="p">),</span> <span class="nx">alias</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>		<span class="c1">//TODO</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">dep</span> <span class="o">+</span> <span class="s1">'.js'</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">define</span><span class="p">.</span><span class="nx">alias</span> <span class="o">=</span> <span class="nx">alias</span><span class="p">;</span>
	<span class="k">return</span> <span class="nx">define</span><span class="p">;</span>
<span class="p">})();</span>

</code></pre>
</div>

<p>测试用例</p>

<p>//上述代码保存为 http://localhost/loader/loader.js</p>

<pre><code class="language-htm">
&lt;!-- index.htm --&gt;
&lt;script src="loader.js"&gt;&lt;/script&gt;

&lt;script&gt;
define.alias['ok'] = 'http://localhost/loader/';
define(['ok/mod1', 'ok/mod2'], function(Mod1, Mod2) {
	console.log('execute index ', Mod1, Mod2);
});
&lt;/script&gt;

</code></pre>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="c1">//   http://localhost/loader/mod1.js</span>
<span class="nx">require</span><span class="p">([</span><span class="s1">'ok/mod2'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">Mod2</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'mod1 index '</span><span class="p">,</span> <span class="nx">Mod2</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">{</span>
		<span class="na">mod1</span><span class="p">:</span> <span class="s1">'this is mod1'</span>
	<span class="p">}</span>
<span class="p">});</span>

</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="c1">//   http://localhost/loader/mod2.js</span>
<span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'mod2 index '</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">{</span>
		<span class="s1">'hello'</span> <span class="p">:</span> <span class="s1">'world'</span>
	<span class="p">}</span>
<span class="p">});</span>

</code></pre>
</div>

<p>补: 其它用法</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">//mod3.js</span>
<span class="c1">//功能模块1</span>
<span class="nx">define</span><span class="p">({</span>
    <span class="na">sayHello</span> <span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">//功能模块2, 模块2没支持!!!</span>
<span class="nx">define</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">sayWorld</span> <span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
           <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'world'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>



</code></pre>
</div>
<div class="highlighter-rouge"><pre class="highlight"><code>
App = {define : define, require: define};
App.define.alias['ok'] = 'http://lhj/loader';
App.define({
      showMsg : function(msg) {
          console.log(msg);
      }
});

App.define(function(Mod3) {
      return {
          say : function() {
				App.require('ok/Mod3', function(Mod3) {
	                  return Mod3.sayHello() + ' ' + '';//Mod3.sayWorld();
				});
          }
      }
});

App.showMsg(123);
App.say();

</code></pre>
</div>
</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-03-03-1439239.html">inline元素上支持的css属性</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-03-03T22:39:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>今天在测试时,意外发现inline元素是可以设置background与border的, 之前有所误解, 故对其它的css属性重新回顾了下</p>

<p>随手写了一个demo:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;h3&gt;</span>inline测试<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width:110px"</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">style=</span><span class="s">"
    background: #ccc;
    padding: 11px;
    margin-left: 80px;
    line-height: 70px;
    border: 1px solid blue;
"</span><span class="nt">&gt;</span>display<span class="nt">&lt;/a&gt;</span>

<span class="nt">&lt;i</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">style=</span><span class="s">"
    background: #ccc;
    padding: 11px;
    margin-left: 80px;
    line-height: 70px;
    border: 1px solid blue;
    min-width: 10px;
    min-height: 10px;
    overflow: hidden;
    max-width: 10px;
    max-height: 10px;.;
    resize: both;
"</span><span class="nt">&gt;</span>inline<span class="nt">&lt;/i&gt;</span>
<span class="nt">&lt;/div&gt;</span>

</code></pre>
</div>

<p>经测试
1. inline元素, 有效的: background, margin-left, margin-right, padding, border
2. inline元素, 无效的: width, height, margin-top, margin-bottom
3. 因width, height无效, 因此下列属性也无效: text-align, text-indent, min|max-width|height, overflow
4. 原文字相关的依然有效, 如word-spacing,  word-wrap,  white-space, letter-spacing
5. 下面两个有效, line-height, vertical-align, box-shadow
6. float,position及与之相关top,left, 不考虑, 已经不是inline了</p>

<p>其中 border, line-height, 这两个可以多多利用</p>

<p><em>思考:</em>
1. inline元素的宽高是不能定义, 即宽高度是由inline元素inline内容的元素决定的,(ie6,ie7下高度会受inline-block元素的影响)
2. 即宽高完全是自适应而得出的, 因此也不存在overflow的问题, min|max-width|height也没有影响
3. margin四个属性, left|right 与 top|bottom 有不同的待遇
4. margin-top, margin-bottom, 可以用line-height模拟, 但有很大不同, 与inline-block也不兼容,  另 margin:0 auto的居中效果, 也没有作用</p>

<p>*其次: *
1. div元素, 使用 display:inline 以上几条也成立
2. button元素, 使用display:inline, 样式没有变化, 等于于inline-block</p>

<p>*最后: *
mdn中说: 默认 inline-level 的元素 (inline + inline-block)</p>

<ul>
  <li>b, big, i, small, tt</li>
  <li>abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var</li>
  <li>a, bdo, br, img, map, object, q, script, span, sub, sup</li>
  <li>button, input, label, select, textarea</li>
</ul>

<p>其中img, button, input, label, select, textarea 并没有以上的特征, 测试了一下, 设置inline与inline-block, 效果是一样的, 没有变化, 都等同于设置了inline-block</p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-02-21-1416013.html">利用bat反编译jar包生成源码jar包</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-02-21T22:27:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>之前曾发表在 csdn(blog.csdn.net/seavers) 上, 不过, csdn的代码乱掉了, 今天重新整理了一下</p>

<p>反编译所使用的工具是jad.exe,笔者的测试版本是1.5.8e,压缩与解压缩使用的是WinRAR</p>

<p>jad.exe 可反编译一个class文件为java文件,笔者的BAT可通过此工具将一个jar包反编译成一个完整的源码jar包,同时生成的目录也可以在eclipse中使用</p>

<p>jad.exe 官方网站 ： http://www.kpdus.com/jad.html   (已失效, 从<a href="https://github.com/seavers/jad">这里</a>或者附件下载)</p>

<p>BAT脚本见后</p>

<p>安装方法如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    复制粘贴后面的文本为一个BAT,然后与jad.exe放在同一个目录即可(WinRAR需正确安装)
</code></pre>
</div>

<p>使用方法如下:   (有3种使用方法, 使用其中任意一种均可,结果是相同的)</p>

<div class="highlighter-rouge"><pre class="highlight"><code> 1. 双击BAT,提示输入需反编译的jar包,请输入完整的jar路径
 2. 直接将 jar 包拖放在bat上
 3.右键点击jar包,选择打开方式,然后选择使用该BAT来执行
</code></pre>
</div>

<p>运行后的结果如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  在jar包的同一目录下, 将会生成一个目录,一个jar,目录下有两个子目录,一个目录存放解压缩后的所有class,一个目录存放反编译后的java文件,jar包是用源码压缩生成的
</code></pre>
</div>

<p>几点说明:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. 工具中使用的WinRAR是自动识别安装路径的,请正确安装WinRAR
2. 工具使用的jad.exe,须与BAT放在同一目录,或者放在PATH可搜索到的位置
3.  jar包中非class文件,也会完整拷贝在源码目录下,方便生成源码工程
4. 生成的目录名与原 jar 包同名, 生成的源码 jar 包的文件名是在原名称中加入-src而生成, 如原 jar 包为 jdbc.jar, 则生成的目录名为 jdbc, 而生成的源码jar 包名则为 jdbc-src.jar
5. eclipse使用方法1, 将BAT生成的目录放在workspace中,然后创建同名工程
6. eclipse使用方法2,在 eclipse 中创建同名工程,使用src为源文件目录,bin为class文件目录,然后将BAT生成的目录拷贝在eclipse的workspace中 
</code></pre>
</div>

<p>该BAT为 blog.csdn.net/seavers 原创, BAT源码仅供个人学习,使用,研究,未经本人同意,不可用于商业用途</p>

<hr />

<p>我通常的使用方式是: 将 bat 与 jad.exe 解压在windows根目录, .jar右键用bat打开发后, 第二次及以后使用就方便多了</p>

<p>BAT更新了一下</p>

<p>BAT源码如下: (请直接拷贝在BAT文件中)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>::功能:     利用bat反编译jar包生成源码jar包
::作者:     seavers
::博客:     http://seavers.iteye.com/
::版本:     1.7


::打开/关闭命令行显示
REM @echo OFF

::::::::::::::::::::::::::::解析并设置变量::::::::::::::::::


::查找jad文件的路径, 这里取的jad.exe, 表示从PATH中查找,如果想手工指定,需在这里修改
set JAD_PATH=jad.exe

::设置解压出的class文件存放的位置(相对路径)
set CLASS_PATH=bin

::设置反编译后的java文件存放的位置(相对路径)
set JAVA_PATH=src

::检查JAD文件是否存在bat所在目录下,
if exist "%~dp0jad.exe" set JAD_PATH=%~dp0jad.exe

::判断参数个数,如果没有文件参数,则报错,这里也可以使用%~f1,也可以用%1,没有关系,之后要去掉引号
if ""%1""=="""" (set /P JAR_PATH=请输入要反编译的JAR包的路径...) else (set JAR_PATH=%~f1)
if '%JAR_PATH:~0,1%%JAR_PATH:~0,1%'=='""' set JAR_PATH=%JAR_PATH:~1,-1%

::获取源代码存放的路径,这里取JAR包所在路径,然后去掉".jar"作为文件夹路径, 这里的LOCATION不能带引号,因为下面还要追加字符)
if ""%2""=="""" (set LOCATION=%JAR_PATH:~0,-4%) else (set LOCATION=%~f2)

::::::::::::::::::::开始执行程序:::::::::::::::::::::::::::::::

::获取WinRAR.exe的路径,设置在临时变量rarpath中
for /f "usebackq delims=" %%i in (`ftype WinRAR`) do set RARPATH=%%i

::对rarpath进行解析,去掉前面7个节符,去掉后面5个字符,得到WinRAR执行路径
::路径大致是这样的形式  Winrar="C:\Program Files\WinRAR\WinRAR.exe" "%1"
set RAREXE=%RARPATH:~7,-5%

::调用WinRAR命令,解压文件到指定目录的bin目录下
%RAREXE% x "%JAR_PATH%" "%LOCATION%\%CLASS_PATH%\"

::遍历整个bin目录,取所有class文件,调用jad.exe反编译出源码,非class的拷贝到src目录下
::打开变量延迟功能
setlocal EnableDelayedExpansion
for /r "%LOCATION%\bin" %%i in (*.*) do if '%%~xi'=='.class' ("%JAD_PATH%"  -o -r -sjava -ff -b -nonlb -space -t -8 -d"%LOCATION%\%JAVA_PATH%" "%%~si") else (set TEMP_PATH=%%i &amp; echo f|xcopy "%%i" "!TEMP_PATH:%LOCATION%\bin=%LOCATION%\src!")
endlocal EnableDelayedExpansion

::将产生的java文件压缩成源码文件
%RAREXE% a -ep1 -r "%LOCATION%-src.zip" "%LOCATION%\%JAVA_PATH%\*.*"


::::::::::::::::::程序结束, 显示运行结果::::::::::::::::::::::
echo *********************************************
echo 程序运行结束
echo 解析的JAR包的路径为 %JAR_PATH%
echo 解压缩工具WinRAR.exe的路径为 %RAREXE%
echo 反编译工具JAD.exe的路径为 %JAD_PATH%
echo 解析后的文件的根路径为 %LOCATION%
echo 解析后的class文件存放在 %LOCATION%\%CLASS_PATH%
echo 解析后的java文件存放在 %LOCATION%\%JAVA_PATH%
echo 压缩后的java文件存放在 %LOCATION%-src.zip
echo *********************************************
pause


</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012-01-12-1343766.html">sync.js</a></h1>
    
    
      <p class="meta">
        









<time datetime="2012-01-12T21:11:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>自己写了一个小工具, 做个备份</p>

<p>支持addTask任务, 每个任务将会同步执行</p>

<p>sync.js</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/*** 
 *   Sync 框架
 *
 *   支持 addTask,  addCirle,  addListener,  finish 等功能
 *
 */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">MAX_TOTAL</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">);</span>

	<span class="kd">function</span> <span class="nx">Sync</span><span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span>			<span class="c1">//执行队列</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">[];</span>			<span class="c1">//listeners</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>				<span class="c1">//总的计数</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDelay</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">delay</span> <span class="o">=</span> <span class="nx">delay</span><span class="p">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">func</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addTask</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addParallelTask</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/** func1, func2, func3...  **/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="nx">func</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addCircle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">total</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">total</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">func</span> <span class="o">=</span> <span class="nx">total</span><span class="p">;</span>
			<span class="nx">total</span> <span class="o">=</span> <span class="nx">MAX_TOTAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
			<span class="na">func</span> <span class="p">:</span> <span class="nx">func</span><span class="p">,</span> 
			<span class="na">total</span> <span class="p">:</span> <span class="nx">total</span><span class="p">,</span>
			<span class="na">index</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
			<span class="na">callback</span> <span class="p">:</span> <span class="nx">callback</span>
		<span class="p">});</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">checkStart</span><span class="p">();</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkStart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">total</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">that</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">return</span> <span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">_execute</span><span class="p">(</span><span class="nx">task</span><span class="p">,</span> <span class="nx">task</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">||</span> <span class="o">++</span><span class="nx">task</span><span class="p">.</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="nx">task</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">that</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
				<span class="nx">that</span><span class="p">.</span><span class="nx">_callback</span><span class="p">(</span><span class="nx">task</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">that</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>			
		<span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">task</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">task</span><span class="p">.</span><span class="nx">func</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">task</span><span class="p">.</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">task</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">Sync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finish</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timer</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">bool</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">bool</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">task</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">task</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">task</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_execute</span><span class="p">(</span><span class="nx">task</span><span class="p">,</span> <span class="nx">j</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="p">}</span>


	<span class="nb">window</span><span class="p">.</span><span class="nx">Sync</span> <span class="o">=</span> <span class="nx">Sync</span><span class="p">;</span>


<span class="p">})();</span>
</code></pre>
</div>

<p>index.htm:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"sync.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>

	<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sync</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	<span class="nx">a</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'notify .'</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)});</span>
	<span class="nx">a</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'execute 2 -- '</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)});</span>
	<span class="nx">a</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'execute 4 -- '</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)});</span>
	<span class="nx">a</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'execute 8 -- '</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)});</span>
	<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">a</span><span class="p">.</span><span class="nx">addCircle</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'execute n -- '</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)});</span>
		<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">a</span><span class="p">.</span><span class="nx">finish</span><span class="p">();</span>
		<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
	<span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>

<span class="nt">&lt;/script&gt;</span>



</code></pre>
</div>
</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011-10-01-1184400.html">with语句的本质</a></h1>
    
    
      <p class="meta">
        









<time datetime="2011-10-01T23:41:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>通过测试及debug后, 得出结论, 仅代表个人意见:</p>

<p>with的本质, 就是构造一个作用域, 将with的对象的所有key, 声明为局部变量</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
var inner = '123';
var outer = {inner : 'hello world', another: 'hello with'};
window.obj = {outer: outer};

with(outer) {
	alert(inner);
	alert(another);
	alert(outer.inner);
	alert(window.obj.outer.inner);
	show();
}


function show() {
	alert(inner);

}
</code></pre>
</div>

<p>等同于以下代码</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
var inner = '123';
var outer = {inner : 'hello world', another: 'hello with'};
window.obj = {outer: outer};

(function(inner, another) {
	alert(inner);
	alert(another);
	alert(outer.inner);
	alert(window.obj.outer.inner);
	show();
})(outer.inner, outer.another);


function show() {
	alert(inner);

}

</code></pre>
</div>

<p>再看看下面这个常见的问题, 一目了然</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var root = { 
    branch: { 
        node: 1 
    } 
}; 

with(root.branch) { 
    root.branch = { 
        node: 0 
    }; 
    // 显示 1, 错误! 
    alert(node); 
} 
// 显示 0, 正确! 
alert(root.branch.node); 
</code></pre>
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    
	
        <li class='category'><a href="/blog/categories/windows/">windows (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/java/">java (9)</a></li>
    
	
        <li class='category'><a href="/blog/categories/game/">game (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/思考/">思考 (9)</a></li>
    
	
        <li class='category'><a href="/blog/categories/ubuntu/">ubuntu (20)</a></li>
    
	
        <li class='category'><a href="/blog/categories/php/">php (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/javascript/">javascript (10)</a></li>
    
	
        <li class='category'><a href="/blog/categories/css/">css (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/maven/">maven (6)</a></li>
    
	
        <li class='category'><a href="/blog/categories/git/">git (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/cubieboard/">cubieboard (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/android/">android (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/nginx/">nginx (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/octopress/">octopress (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/html5/">html5 (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/hive/">hive (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/chrome/">chrome (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/ruby/">ruby (5)</a></li>
    
	
        <li class='category'><a href="/blog/categories/mybatis/">mybatis (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/jekyll/">jekyll (1)</a></li>
    
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018-09-18-maven-archetype-multimodule.html">maven构建archetype多模块工程模板的问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016-02-12-java-native-list.html">java native方法列表</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016-02-07-jekyll-update.html">升级jekyll</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-25-mybatis-dong-tai-sao-miao-xml.html">mybatis 动态扫描xml</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-01-19-ruby-multiple-return.html">ruby语法糖 - 多返回值</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>大牛博客</h1>
  <ul>
    <li>
      <a href="http://ithans.com/">ithans</a>
    </li>
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - lianghaijun -
  <span class="credit">Powered by <a target="_blank" href="http://jekyllrb.com">jekyll</a></span>
</p>
</footer>
  <script src="/blog/static/jquery.min.js"></script>
<script src="/blog/static/blog.js?tag=20160209"></script>
<script src='http://hm.baidu.com/h.js?f1e7ae48ee023d8ed983af30c485b5ce'></script>


</body>
</html>
