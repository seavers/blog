
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>大海Online的博客</title>
  <meta name="author" content="lianghaijun">

  
  <meta name="description" content="
  
  
    
    
      
  
    
      maven构建archetype多模块工程模板的问题
    
    
      
        










      
    
  


  今天遇到了maven创建archetype多模块工程时...">
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.lianghaijun.com/">
  <link href="/blog/static/screen.css" media="screen, projection" rel="stylesheet">
  <link href="" rel="alternate" title="大海Online的博客" type="application/atom+xml">
</head>

<body   >
  <header role="banner"><hgroup>
  <div id="wb_connect_btn"></div>
  <h1><a href="/">大海Online的博客</a></h1>
  
    <h2>Looking for Interest</h2>
  
</hgroup>
</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<ul class="main-navigation">
  <li><a href="/blog/archives.html">Archives</a></li>
  <li><a href="/blog/link.html">link</a></li>
  <li><a href="/blog/about.html">about</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018-09-18-maven-archetype-multimodule.html">maven构建archetype多模块工程模板的问题</a></h1>
    
    
      <p class="meta">
        









<time datetime="2018-09-18T20:40:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>今天遇到了maven创建archetype多模块工程时的很多问题, 记录一下</p>

<h4 id="archetype">archetype工程的创建可以参考:</h4>
<ul>
  <li><a href="http://maven.apache.org/archetype/maven-archetype-plugin/index.html">官方入口</a></li>
  <li><a href="http://maven.apache.org/archetype/maven-archetype-plugin/examples/create-multi-module-project.html">官方文档</a></li>
</ul>

<h4 id="section">问题如下:</h4>

<ul>
  <li>多模块时生成archetype-metadata.xml的问题
    <ul>
      <li>单模块工程时, 可以直接写archetype-metadata.xml文件</li>
      <li>多模块工程时, 不可以写archetype-metadata.xml, 因为外层工程没有src目录</li>
      <li>解决方案: 多模块工程可以配置出archetype-metadata.xml, 参考 <a href="http://maven.apache.org/archetype/maven-archetype-plugin/examples/create-with-property-file.html">这里</a></li>
    </ul>
  </li>
  <li>无法拷贝.gitignore文件的问题
    <ul>
      <li>参考<a href="https://stackoverflow.com/questions/7981060/maven-archetype-plugin-doesnt-let-resources-in-archetype-resources-through">这里</a>的解决方案</li>
    </ul>
  </li>
</ul>

<h4 id="section-1">解决方案如下:</h4>
<ul>
  <li>将.gitignore改名为__gitignore__</li>
  <li>创建archetype.properties文件</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>## generate for archetype-metadata.xml
excludePatterns=archetype.properties,*.iml,.idea/,.idea/libraries,logs/,build.sh


## generate .gitignore file
gitignore=.gitignore
</code></pre>
</div>

<ul>
  <li>修改pom文件, 多模块工程最外层的pom文件</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.2&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;addDefaultExcludes&gt;false&lt;/addDefaultExcludes&gt;      &lt;!-- 解决复制.gitignore的问题 --&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-archetype-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;propertyFile&gt;archetype.properties&lt;/propertyFile&gt;   &lt;!-- 解决排除.idea目录的问题 --&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
</code></pre>
</div>

<p>完美解决以上两个问题</p>
</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016-02-12-java-native-list.html">java native方法列表</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-02-12T12:40:08+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>想了解一下JDK里有多少方法是用navtive实现的, 所以统计了下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">registerNatives</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">.</span><span class="na">wait</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">);</span>

<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">.</span><span class="na">intern</span><span class="o">();</span>

<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Throwable</span><span class="o">.</span><span class="na">fillInStackTrace</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Throwable</span><span class="o">.</span><span class="na">getStackTraceDepth</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Throwable</span><span class="o">.</span><span class="na">getStackTraceElement</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">);</span>

<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">registerNatives</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">forName0</span><span class="o">(</span><span class="n">String</span> <span class="kd">native</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">initialize</span><span class="o">,</span> <span class="n">ClassLoader</span> <span class="n">loader</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">isInstance</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">isInterface</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">isArray</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">isPrimitive</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getName0</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getClassLoader0</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getSuperclass</span><span class="o">();</span>
<span class="c1">//.......</span>

<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">registerNatives</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">setIn0</span><span class="o">(</span><span class="n">InputStream</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">setOut0</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">setErr0</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">Object</span><span class="o">,</span> <span class="kt">int</span><span class="o">,</span> <span class="n">Object</span><span class="o">,</span> <span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">identityHashCode</span><span class="o">(</span><span class="n">Object</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">initProperties</span><span class="o">(</span><span class="n">Properties</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">System</span><span class="o">.</span><span class="na">mapLibraryName</span><span class="o">(</span><span class="n">String</span><span class="o">);</span>


<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">registerNatives</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">yield</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="kt">long</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">start0</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">isInterrupted</span><span class="o">(</span><span class="kt">boolean</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">();</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">holdsLock</span><span class="o">(</span><span class="n">Object</span><span class="o">);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">dumpThreads</span><span class="o">(</span><span class="n">Thread</span><span class="o">[]);</span>
<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">getThreads</span><span class="o">();</span>
<span class="c1">//......</span>

<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Proxy</span><span class="o">.</span><span class="na">defineClass0</span><span class="o">(</span><span class="n">ClassLoader</span><span class="o">,</span> <span class="n">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[],</span> <span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">);</span>

</code></pre>
</div>

<p>得出以下结论:</p>

<ul>
  <li>这里的Object,Class,Throwable,System,Thread 都是比较底层的功能,都有native的方法</li>
  <li>直接依赖了包装了native的类, 如
    <ul>
      <li>Math -&gt; StrictMath</li>
      <li>File -&gt; FileSystem</li>
      <li>Socket -&gt; PlainSocketImpl</li>
    </ul>
  </li>
  <li>java.lang.reflect包里的多数是Pojo, 都是从Class获取到的Pojo, 然后是纯内存操作, 但 Array 比较例外</li>
  <li>有很多纯内存计算, 没有使用native方法了, 如
    <ul>
      <li>String里编码转换</li>
      <li>Date的api</li>
      <li>ArrayList, HashMap的API</li>
      <li>对象的序列化</li>
      <li>BigInteger, BigDecimal数字运算</li>
      <li>字符串格式化</li>
    </ul>
  </li>
  <li>System, Thread, Runtime, Process都是系统核心紧密的, 几乎都需要调用至native方法的</li>
  <li>Class, Object则是语言相关的, 需要操作至字节码, 也几乎都是调用至native方法的</li>
  <li>还有比较特殊的 sun.misc.Unsafe 类, 主要是互斥锁类的API, 用于concurrent包</li>
</ul>

<p>而jdk之上, 几乎就很少有native了, 如以下</p>

<ul>
  <li>http的实现</li>
  <li>sql,jdbc,log的实现</li>
  <li>各类app应用</li>
</ul>

<p>所以总结了下, 涉及native的共几类</p>

<ul>
  <li>系统相关的 System, Runtime, Process, Thread, Unsafe, File, Socket</li>
  <li>语言相关的 Object, Class, Array, ClassLoader</li>
  <li>计算密集型的 StrictMath</li>
</ul>

<p>其实看native源代码是最直观的了, 点击 <a href="http://hg.openjdk.java.net/jdk7u/jdk7u/jdk/file/tip/src/share/native/java/lang/">http://hg.openjdk.java.net/jdk7u/jdk7u/jdk/file/tip/src/share/native/java/lang/</a>
或
<a href="https://github.com/dmlloyd/openjdk/tree/jdk7u/jdk7u/jdk/src/share/native/java/lang">https://github.com/dmlloyd/openjdk/tree/jdk7u/jdk7u/jdk/src/share/native/java/lang</a></p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016-02-07-jekyll-update.html">升级jekyll</a></h1>
    
    
      <p class="meta">
        









<time datetime="2016-02-07T15:08:29+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>原先博客是使用 octopress 搭建的blog, jekyll版本是0.12
其中一个代码弊端是blog的源码中, source与octopress的部分代码耦合
所以希望能将代码分离, 这里采用直接jekyll的方案</p>

<p>使用jekyll的方案</p>

<ul>
  <li>jekyll3 需要ruby2.0以上版本,安装总是出错,解决方案</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo ln -sf ~/.rvm/rubies/ruby-2.2.1/bin/ruby /usr/bin/ruby
sudo ln -sf ~/.rvm/rubies/ruby-2.2.1/bin/gem /usr/bin/gem
</code></pre>
</div>

<ul>
  <li>
    <p>jekyll3升级了很多基本组件, 也存在很多的不兼容<br />
 markdown的解析组件有maruku|rdiscount|redcarpet|kramdown, 其中默认移除redcarpet, 采用kramdown</p>

    <table>
      <tbody>
        <tr>
          <td>highlighter的解析组件有pygments</td>
          <td>coderay</td>
          <td>rouge, 其中默认中移除pygments, 采用rouge</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>原先的markdown使用```做为code block的符号, 新的kramdown没有默认支持</p>
    <ul>
      <li>jekyll2中使用 kramdown.input=GFM , 可以继续使用</li>
      <li>jekyll3.1.1时, 因为bug的原因, 无法支持,  参考 <a href="http://www.tuicool.com/articles/aQ3aqq">http://www.tuicool.com/articles/aQ3aqq</a> 可以解决</li>
      <li>但是```前有没有换行符, 对页面的展现, 有着不同的展示方案</li>
    </ul>
  </li>
</ul>

<h2 id="bug">自己遇到的一些bug</h2>
<ul>
  <li>Q: Don’t know how to build task ‘default’</li>
  <li>A: rake -v 不支持, 应该是 rake -V ,也就是说后面的命令有问题</li>
  <li>Q: jekyll requires Ruby version &gt;= 2.0.0.</li>
  <li>A: rvm是安排在当前用户的, sudo时使用的 /usr/bin/ruby /usr/bin/gem的, 需要修正
    另外: ubuntu的ruby2.0也有问题, 切换至/usr/bin/ruby切换至rvm的2.2时, 问题解决</li>
  <li>Q: ERROR: While executing gem … (TypeError) no implicit conversion of nil int</li>
  <li>A: 同上</li>
</ul>

<hr />

<p>参考文档:
1. <a href="http://www.tuicool.com/articles/rAnmQvB">Jekyll kramdown配置</a></p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014-11-25-mybatis-dong-tai-sao-miao-xml.html">mybatis 动态扫描xml</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-11-25T08:34:29+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>之前在java工程中引入mybatis, 在配置xml时总是这样子的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"userMapper"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.mapper.MapperFactoryBean"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperInterface"</span> <span class="na">value=</span><span class="s">"com.company.application.mapper.auth.UserMapper"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sqlSessionFactory"</span> <span class="na">ref=</span><span class="s">"sqlSessionFactory"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"permissionMapper"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.mapper.MapperFactoryBean"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperInterface"</span> <span class="na">value=</span><span class="s">"com.company.application.mapper.auth.PermissionMapper"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sqlSessionFactory"</span> <span class="na">ref=</span><span class="s">"sqlSessionFactory"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"roleMapper"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.mapper.MapperFactoryBean"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperInterface"</span> <span class="na">value=</span><span class="s">"com.company.application.mapper.auth.RoleMapper"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sqlSessionFactory"</span> <span class="na">ref=</span><span class="s">"sqlSessionFactory"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
</code></pre>
</div>

<p>系统每增加一个mapper都要去配置一个bean, 这样不仅繁锁,而且多人编辑文件时,容易引起代码冲突</p>

<p>其实可以使用自动扫描的方式去加载所有的mapper文件,方法如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"basePackage"</span> <span class="na">value=</span><span class="s">"com.company.application.mapper"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sqlSessionFactory"</span> <span class="na">ref=</span><span class="s">"sqlSessionFactory"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
</code></pre>
</div>

<p>这个MapperScannerConfigurer是在mybatis-spring包中定义的
引入方法为</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="nt">&lt;dependency&gt;</span>
		<span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
		<span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
		<span class="nt">&lt;version&gt;</span>1.1.1<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;/dependency&gt;</span>
</code></pre>
</div>

<p>如果是 MyBatis-Spring 1.2.0 以上, 还有一种更简单的方法, <mybatis:scan></mybatis:scan>
见http://mybatis.github.io/spring/mappers.html    (英文)
或http://mybatis.github.io/spring/zh/mappers.html (中文)</p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014-01-19-ruby-multiple-return.html">ruby语法糖 - 多返回值</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-01-19T13:01:18+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>前几天写代码的时候, 使用到了ruby的多返回值, 觉得很值得写一写</p>

<p>记得第一次看见多返回值, 是在lua中, 当时觉得不过是一语法糖, 没什么特别的, 并不会带来什么特别的好处, 就没有细细研究下去</p>

<p>多返回值, 比较经典的使用场景是交换数值, 最常用于排序等各类算法中, 比如</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span>
</code></pre>
</div>

<p>而实际中, 我碰到的使用场景是这样的, 解析一个文本文件</p>

<p>常见的写法这样的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="no">IO</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s1">'20140119_result.txt'</span><span class="p">).</span><span class="nf">lines</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">name</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">type</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="nb">puts</span> <span class="s2">"[</span><span class="si">#{</span><span class="n">status</span><span class="si">}</span><span class="s2">] </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span> <span class="k">if</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="p">}</span>   
</code></pre>
</div>

<p>如果用多返回值, 效果就完全不同了, 而且达到了相同的效果</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	IO.read('20140119_result.txt').lines.each { |line|
		id,name,type,status = line.split(',')
		puts "[#{status}] #{name}/#{id}" if type == 1
	}
</code></pre>
</div>

<p>在java中, 经常见一些让我很痛苦的写法, 如</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="n">Result</span><span class="o">&lt;</span><span class="n">PairValue</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">NoSql</span><span class="o">.</span><span class="na">getValue</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
	<span class="k">if</span><span class="o">(!</span><span class="n">result</span><span class="o">.</span><span class="na">isSuccess</span> <span class="o">||</span> <span class="n">result</span><span class="o">.</span><span class="na">getResult</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">result</span><span class="o">.</span><span class="na">getResult</span><span class="o">().</span><span class="na">getValue</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"......"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getError</span><span class="o">());</span>
	<span class="o">}</span>
	<span class="n">Model</span> <span class="n">model</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getResult</span><span class="o">().</span><span class="na">getValue</span><span class="o">();</span>
</code></pre>
</div>

<p>单独看这行代码, 你觉得无所谓, 但是一个方法里, 只有四行逻辑, 但却有16行代码,其中12个是这种判断,你就是发疯了,看代码太累了,无法直接看到主要的逻辑</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="n">model</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="no">NoSql</span><span class="p">.</span><span class="nf">getValue</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
	<span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">"...."</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="k">if</span> <span class="n">err</span>

	<span class="no">List</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="no">Service</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">itemIds</span><span class="p">)</span>
	<span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s2">"...."</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="k">if</span> <span class="n">err</span>
</code></pre>
</div>

<p>纵观代码, 会把注意力集中到业务逻辑上, 而不是各种返回结果的判断上</p>

<h2 id="section">本质</h2>

<p>让我们来看看, ruby多返回值的本质</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	<span class="k">def</span> <span class="nf">multi</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span>
	<span class="k">end</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">multi</span>
	<span class="nb">puts</span> <span class="n">result</span><span class="p">.</span><span class="nf">class</span>   <span class="c1">## Array</span>
	<span class="nb">puts</span> <span class="n">result</span> <span class="o">===</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>  <span class="c1">## true </span>
</code></pre>
</div>

<p>我们发现, 原来ruby的多返回值就是一个数组, 而且</p>

<ul>
  <li>x=1,2,3,4,5,6 与 x=[1,2,3,4,5,6]  写法是一样的,结果也一样</li>
  <li>x,y=1,2,3,4,5,6 与 x,y=[1,2,3,4,5,6]  写法也是一样的,结果也一样</li>
  <li>不一样的一点是   [1,2,3,4,5,6].class 与  (1,2,3,4,5,6).class 是不一样的, 后面会报语法错误</li>
  <li>因此, 不带中括号, 其实是一种简写的方式, 只是有些地方能简单, 有些地方无法简写</li>
  <li>从另一个角度来看, []其实也是一种运算符号, 与()一样, 是为了提高运算符的优先级</li>
</ul>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014-01-12-ruby-enumerable.html">ruby Enumerator</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-01-12T17:33:56+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>之前看到这样的API文档</p>

<p>关于数组Array的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>map { |item| block } → new_ary click to toggle source
map → Enumerator
Invokes the given block once for each element of self.

Creates a new array containing the values returned by the block.

See also Enumerable#collect.

If no block is given, an Enumerator is returned instead.
</code></pre>
</div>

<p>当时不明白, Array的map方法不带参数时返回 Enumerator, 而Array已经支持各类迭代操作了, 为什么还要返回Enumerator, 与数组的操作有什么区别呢, 当时没有细究, 今天知道了</p>

<!--more-->

<p>我们知道数组是继承自Enumerable的</p>

<div class="highlighter-rouge"><pre class="highlight"><code>irb(main):077:0&gt; [].class.ancestors
=&gt; [Array, Enumerable, Object, Kernel, BasicObject]
</code></pre>
</div>

<p>数组中的方法, 会比Enumerable多一些数组特色的方法, 如insert,push,pop,fist,last</p>

<p>而Enumerable调用map时, 有一些常用的方法, 无法满足, 比如</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	[2,3,5,7,9,11].map {|item,index| item+index}
</code></pre>
</div>

<p>map时, 参数中的第一个参数, 为item, 但是不支持索引位置</p>

<p>而像select, count, reject 等方法时, 同样也不支持索引位置</p>

<p>于是Enumerator发挥作用了, 注意这里不是Enumerable</p>

<div class="highlighter-rouge"><pre class="highlight"><code>irb(main):071:0&gt; [].map.methods - [].methods
=&gt; [:with_index, :with_object, :next_values, :peek_values, :next, :peek, :feed, :rewind]
</code></pre>
</div>

<p>所以
<code class="highlighter-rouge">
irb(main):109:0&gt; [2,3,5,7,9,11].map.with_index {|item,index| item+index}
=&gt; [2, 4, 7, 10, 13, 16]
</code></p>

<p>结论: Array中map,select,count,reject时, 如果不带闭包参数, 将返回Enumerator, 这时可继续使用索引参数</p>

<p>这里是ruby的官方文档, <a href="http://ruby-doc.org/core-1.9.3/Enumerator.html">Enumerator的API</a></p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014-01-05-ruby-string-array.html">ruby 字符串与数组</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-01-05T18:55:00+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>ruby的字符串与数组,在API设计上,有很多的相似之处,同时方法广度上,又有所区分,这里还是有很多学问</p>

<!--more-->

<p>字符串在底层上是字符的数组, 同是数组, 我们先从相同点开始</p>

<h3 id="section">比较方法名</h3>

<p>让我们先单纯的比较一下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>'string'.methods.length   ### 161
('string'.methods - Object.new.methods).length   ## 107

[].methods.length         ### 167
([].methods - Object.new.methods).length   ## 113

([].methods &amp; 'string'.methods).length    ## 76
([].methods &amp; 'string'.methods - Object.new.methods).length  ## 22

[].methods &amp; 'string'.methods - Object.new.methods
[:[], :[]=, :concat, :&lt;&lt;, :insert, :length, :size, :empty?, :index, :rindex, :reverse, :reverse!, :delete, :replace, :clear, :include?, :slice, :slice!, :+, :*, :count, :partition]
</code></pre>
</div>

<ul>
  <li>字符串共有161个方法,去掉继承后, 剩107个</li>
  <li>数组共有167个方法,去掉继承后,剩113个</li>
  <li>字符串与数组相同的方法,共有76,去掉继承的54个, 只剩22个</li>
</ul>

<p>让我们来仔细看看这22个方法</p>

<ul>
  <li>[],[]=, 下标操作</li>
  <li>[],slice,slice! 子字符串,子数组操作</li>
  <li>«,insert,+,*       插入操作</li>
  <li>length,size,count,empty?   大小计算</li>
  <li>index,rindex,include?    查找</li>
  <li>reverse, reverse!  反转</li>
  <li>delete,clear          删除</li>
  <li>partition         拆分 (数组中没找到此方法????)</li>
</ul>

<p>汇总起来, 就是 增删改查, 子反转,大小</p>

<h3 id="section-1">字符串</h3>

<p>而字符串中去掉数组的方法, 就是真正的字符串操作了
<code class="highlighter-rouge">
irb(main):026:0&gt; 'string'.methods - [].methods
=&gt; [:casecmp, :%, :bytesize, :match, :succ, :succ!, :next, :next!, :upto, :chr, :getbyte, :setbyte, :byteslice, :to_i, :to_f, :to_str, :dump, :upcase, :downcase, :capitalize, :swapcase, :upcase!, :downcase!, :capitalize!, :swapcase!, :hex, :oct, :split, :lines, :bytes, :chars, :codepoints, :prepend, :crypt, :intern, :to_sym, :ord, :start_with?, :end_with?, :scan, :ljust, :rjust, :center, :sub, :gsub, :chop, :chomp, :strip, :lstrip, :rstrip, :sub!, :gsub!, :chop!, :chomp!, :strip!, :lstrip!, :rstrip!, :tr, :tr_s, :squeeze, :tr!, :tr_s!, :delete!, :squeeze!, :each_line, :each_byte, :each_char, :each_codepoint, :sum, :rpartition, :encoding, :force_encoding, :b, :valid_encoding?, :ascii_only?, :unpack, :encode, :encode!, :to_r, :to_c, :&gt;, :&gt;=, :&lt;, :&lt;=, :between?]
</code></p>

<p>其中: getbyte,setbyte,byteslice,split,bytes,chars,codepoints,prepend,start_with?,end_with? ,sub,gsub,sub!,gsub!,delete!,each_line,each_byte,each_char,each_codepoint 等等,其实也是围绕这个概念,派生出来的方法,都是在”部分”,”全体”, 在这个概念上生成的方法</p>

<p>而to_i, to_f, hex, &lt; &gt; 等, 这些是属于转换与比较的方法, 另upcase,downcase 是字符串间的转换</p>

<p>除去这个概念后, 与字符串本质有关的方法, 只有encoding,force_encoding 这几个方法了</p>

<p>所以字符串的方法, 我们可以归结为三类</p>

<ul>
  <li>字符数组, 数组的操作方法</li>
  <li>转换与比较</li>
  <li>编码相关</li>
</ul>

<h3 id="section-2">数组</h3>

<p>让我们再来看看数组</p>

<div class="highlighter-rouge"><pre class="highlight"><code>irb(main):031:0&gt; [].methods - 'string'.methods
=&gt; [:to_a, :to_ary, :at, :fetch, :first, :last, :push, :pop, :shift, :unshift, :each, :each_index, :reverse_each, :find_index, :join, :rotate, :rotate!, :sort, :sort!, :sort_by!, :collect, :collect!, :map, :map!, :select, :select!, :keep_if, :values_at, :delete_at, :delete_if, :reject, :reject!, :zip, :transpose, :fill, :assoc, :rassoc, :-, :&amp;, :|, :uniq, :uniq!, :compact, :compact!, :flatten, :flatten!, :shuffle!, :shuffle, :sample, :cycle, :permutation, :combination, :repeated_permutation, :repeated_combination, :product, :take, :take_while, :drop, :drop_while, :bsearch, :pack, :entries, :sort_by, :grep, :find, :detect, :find_all, :flat_map, :collect_concat, :inject, :reduce, :group_by, :all?, :any?, :one?, :none?, :min, :max, :minmax, :min_by, :max_by, :minmax_by, :member?, :each_with_index, :each_entry, :each_slice, :each_cons, :each_with_object, :chunk, :slice_before, :lazy]
</code></pre>
</div>

<p>我们再来分下组</p>

<ul>
  <li>常用的增删改查, 子反转,大小</li>
  <li>同样的转换与比较  to_a</li>
  <li>单项相关,   at,first,last,pop,min,max,take</li>
  <li>遍历,     each,each_index, collect, map,select, take_while,drop_while,grep,find,find_all,reduce,all?,any?,one?, each_*</li>
</ul>

<h3 id="section-3">后续</h3>

<p>我们可以看出,在数组中有很多方法,并没有在字符串中体现,字符串中部分数组的方法,必定是最常用</p>

<p>假如,数组里所有的方法,都放在字符串中,虽然行得通,但并不好,相反不好理解, 比如string.grep,实际意义不大</p>

<p>所以我们现在可以理解, 为什么 String 不是直接继承自 Array 了, 因为Array并不是String的核心, String中最核心的应该是别的, 比如字符与编码</p>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014-01-04-ruby-study-notes.html">ruby 学习笔记</a></h1>
    
    
      <p class="meta">
        









<time datetime="2014-01-04T21:39:33+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><style>
figure.code{width: 48%; display:inline-block}
</style>

<p>学习ruby已经有一段时间了, 抽点时间把常用的语法方法总结一下, 算是入门小笔记吧</p>

<!--more-->

<h2 id="section">简述</h2>

<ul>
  <li>ruby为动态语言,弱类型,一切皆对象(就是可以.)</li>
  <li>ruby没有属性,只有方法,看似属性的,其实都只是其成员变量的读方法</li>
  <li>ruby调用方法时括号可省略, 行尾无分号, return 关键字可省略</li>
  <li>ruby支持[]语法创建变长数组, {}语法创建Hash对象, 支持闭包</li>
</ul>

<h2 id="section-1">常用的语法结构</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">#encoding:utf-8</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="c1"># comment</span>

<span class="k">return</span> <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>

<span class="k">if</span><span class="p">(</span><span class="n">page</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span>
	<span class="nb">puts</span> <span class="n">i</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s1">'.'</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">step</span> <span class="k">in</span> <span class="p">[</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'two'</span><span class="p">,</span><span class="s1">'three'</span><span class="p">]</span>
	<span class="n">process</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">list</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
	<span class="nb">puts</span> <span class="s2">"echo </span><span class="si">#{</span><span class="n">x</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="n">list</span><span class="p">.</span><span class="nf">each_index</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"echo </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">#{</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">nilisnull</span>
	<span class="kp">nil</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">===</span> <span class="s1">''</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">x</span>
<span class="k">when</span> <span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">10</span>              <span class="c1">#匹配数字</span>
    <span class="nb">puts</span> <span class="s2">"First branch"</span>
<span class="k">when</span> <span class="n">foobar</span><span class="p">()</span>           <span class="c1">#批量方法返回的值</span>
    <span class="nb">puts</span> <span class="s2">"Second branch"</span>
<span class="k">when</span> <span class="sr">/^hel.*/</span>           <span class="c1">#匹配正则表达式</span>
    <span class="nb">puts</span> <span class="s2">"Third branch"</span>
<span class="k">else</span>  
    <span class="nb">puts</span> <span class="s2">"Last branch"</span>
<span class="k">end</span>
</code></pre>
</div>

<h2 id="section-2">方法符号</h2>

<p>语法上除了一些常见的顺序,选择,循环,变量,函数,模块,类, 还有一些特有的内容</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1"># 查看一个变量可以调用哪些方法</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mi">108</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="s1">'string'</span><span class="p">.</span><span class="nf">methods</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="ss">:&lt;=&gt;</span><span class="p">,</span> <span class="ss">:==</span><span class="p">,</span> <span class="ss">:===</span><span class="p">,</span> <span class="ss">:eql?</span><span class="p">,</span> <span class="ss">:hash</span><span class="p">,</span> <span class="ss">:casecmp</span><span class="p">,</span> <span class="p">:</span><span class="o">+</span><span class="p">,</span> <span class="p">:</span><span class="o">*</span><span class="p">,</span> <span class="ss">:%</span><span class="p">,</span> <span class="ss">:[]</span><span class="p">,</span> <span class="ss">:[]=</span><span class="p">,</span> <span class="ss">:insert</span><span class="p">,</span> <span class="ss">:length</span><span class="p">,</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">:bytesize</span><span class="p">,</span> <span class="ss">:empty?</span><span class="p">,</span> <span class="p">:</span><span class="o">=~</span><span class="p">,</span> <span class="ss">:match</span><span class="p">,</span> <span class="ss">:succ</span><span class="p">,</span> <span class="ss">:succ!</span><span class="p">,</span> <span class="ss">:next</span><span class="p">,</span> <span class="ss">:next!</span><span class="p">,</span> <span class="ss">:upto</span><span class="p">,</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:rindex</span><span class="p">,</span> <span class="ss">:replace</span><span class="p">,</span> <span class="ss">:clear</span><span class="p">,</span> <span class="ss">:chr</span><span class="p">,</span> <span class="ss">:getbyte</span><span class="p">,</span> <span class="ss">:setbyte</span><span class="p">,</span> <span class="ss">:byteslice</span><span class="p">,</span> <span class="ss">:to_i</span><span class="p">,</span> <span class="ss">:to_f</span><span class="p">,</span> <span class="ss">:to_s</span><span class="p">,</span> <span class="ss">:to_str</span><span class="p">,</span> <span class="ss">:inspect</span><span class="p">,</span> <span class="ss">:dump</span><span class="p">,</span> <span class="ss">:upcase</span><span class="p">,</span> <span class="ss">:downcase</span><span class="p">,</span> <span class="ss">:capitalize</span><span class="p">,</span> <span class="ss">:swapcase</span><span class="p">,</span> <span class="ss">:upcase!</span><span class="p">,</span> <span class="ss">:downcase!</span><span class="p">,</span> <span class="ss">:capitalize!</span><span class="p">,</span> <span class="ss">:swapcase!</span><span class="p">,</span> <span class="ss">:hex</span><span class="p">,</span> <span class="ss">:oct</span><span class="p">,</span> <span class="ss">:split</span><span class="p">,</span> <span class="ss">:lines</span><span class="p">,</span> <span class="ss">:bytes</span><span class="p">,</span> <span class="ss">:chars</span><span class="p">,</span> <span class="ss">:codepoints</span><span class="p">,</span> <span class="ss">:reverse</span><span class="p">,</span> <span class="ss">:reverse!</span><span class="p">,</span> <span class="ss">:concat</span><span class="p">,</span> <span class="ss">:&lt;&lt;</span><span class="p">,</span> <span class="ss">:prepend</span><span class="p">,</span> <span class="ss">:crypt</span><span class="p">,</span> <span class="ss">:intern</span><span class="p">,</span> <span class="ss">:to_sym</span><span class="p">,</span> <span class="ss">:ord</span><span class="p">,</span> <span class="ss">:include?</span><span class="p">,</span> <span class="ss">:start_with?</span><span class="p">,</span> <span class="ss">:end_with?</span><span class="p">,</span> <span class="ss">:scan</span><span class="p">,</span> <span class="ss">:ljust</span><span class="p">,</span> <span class="ss">:rjust</span><span class="p">,</span> <span class="ss">:center</span><span class="p">,</span> <span class="ss">:sub</span><span class="p">,</span> <span class="ss">:gsub</span><span class="p">,</span> <span class="ss">:chop</span><span class="p">,</span> <span class="ss">:chomp</span><span class="p">,</span> <span class="ss">:strip</span><span class="p">,</span> <span class="ss">:lstrip</span><span class="p">,</span> <span class="ss">:rstrip</span><span class="p">,</span> <span class="ss">:sub!</span><span class="p">,</span> <span class="ss">:gsub!</span><span class="p">,</span> <span class="ss">:chop!</span><span class="p">,</span> <span class="ss">:chomp!</span><span class="p">,</span> <span class="ss">:strip!</span><span class="p">,</span> <span class="ss">:lstrip!</span><span class="p">,</span> <span class="ss">:rstrip!</span><span class="p">,</span> <span class="ss">:tr</span><span class="p">,</span> <span class="ss">:tr_s</span><span class="p">,</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:squeeze</span><span class="p">,</span> <span class="ss">:count</span><span class="p">,</span> <span class="ss">:tr!</span><span class="p">,</span> <span class="ss">:tr_s!</span><span class="p">,</span> <span class="ss">:delete!</span><span class="p">,</span> <span class="ss">:squeeze!</span><span class="p">,</span> <span class="ss">:each_line</span><span class="p">,</span> <span class="ss">:each_byte</span><span class="p">,</span> <span class="ss">:each_char</span><span class="p">,</span> <span class="ss">:each_codepoint</span><span class="p">,</span> <span class="ss">:sum</span><span class="p">,</span> <span class="ss">:slice</span><span class="p">,</span> <span class="ss">:slice!</span><span class="p">,</span> <span class="ss">:partition</span><span class="p">,</span> <span class="ss">:rpartition</span><span class="p">,</span> <span class="ss">:encoding</span><span class="p">,</span> <span class="ss">:force_encoding</span><span class="p">,</span> <span class="ss">:b</span><span class="p">,</span> <span class="ss">:valid_encoding?</span><span class="p">,</span> <span class="ss">:ascii_only?</span><span class="p">,</span> <span class="ss">:unpack</span><span class="p">,</span> <span class="ss">:encode</span><span class="p">,</span> <span class="ss">:encode!</span><span class="p">,</span> <span class="ss">:to_r</span><span class="p">,</span> <span class="ss">:to_c</span><span class="p">,</span> <span class="p">:</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">:</span><span class="o">&gt;=</span><span class="p">,</span> <span class="ss">:&lt;</span><span class="p">,</span> <span class="ss">:&lt;=</span><span class="p">,</span> <span class="ss">:between?</span><span class="p">,</span> <span class="ss">:nil?</span><span class="p">,</span> <span class="p">:</span><span class="o">!~</span><span class="p">,</span> <span class="ss">:class</span><span class="p">,</span> <span class="ss">:singleton_class</span><span class="p">,</span> <span class="ss">:clone</span><span class="p">,</span> <span class="ss">:dup</span><span class="p">,</span> <span class="ss">:taint</span><span class="p">,</span> <span class="ss">:tainted?</span><span class="p">,</span> <span class="ss">:untaint</span><span class="p">,</span> <span class="ss">:untrust</span><span class="p">,</span> <span class="ss">:untrusted?</span><span class="p">,</span> <span class="ss">:trust</span><span class="p">,</span> <span class="ss">:freeze</span><span class="p">,</span> <span class="ss">:frozen?</span><span class="p">,</span> <span class="ss">:methods</span><span class="p">,</span> <span class="ss">:singleton_methods</span><span class="p">,</span> <span class="ss">:protected_methods</span><span class="p">,</span> <span class="ss">:private_methods</span><span class="p">,</span> <span class="ss">:public_methods</span><span class="p">,</span> <span class="ss">:instance_variables</span><span class="p">,</span> <span class="ss">:instance_variable_get</span><span class="p">,</span> <span class="ss">:instance_variable_set</span><span class="p">,</span> <span class="ss">:instance_variable_defined?</span><span class="p">,</span> <span class="ss">:remove_instance_variable</span><span class="p">,</span> <span class="ss">:instance_of?</span><span class="p">,</span> <span class="ss">:kind_of?</span><span class="p">,</span> <span class="ss">:is_a?</span><span class="p">,</span> <span class="ss">:tap</span><span class="p">,</span> <span class="ss">:send</span><span class="p">,</span> <span class="ss">:public_send</span><span class="p">,</span> <span class="ss">:respond_to?</span><span class="p">,</span> <span class="ss">:extend</span><span class="p">,</span> <span class="ss">:display</span><span class="p">,</span> <span class="ss">:method</span><span class="p">,</span> <span class="ss">:public_method</span><span class="p">,</span> <span class="ss">:define_singleton_method</span><span class="p">,</span> <span class="ss">:object_id</span><span class="p">,</span> <span class="ss">:to_enum</span><span class="p">,</span> <span class="ss">:enum_for</span><span class="p">,</span> <span class="ss">:equal?</span><span class="p">,</span> <span class="p">:</span><span class="o">!</span><span class="p">,</span> <span class="p">:</span><span class="o">!=</span><span class="p">,</span> <span class="ss">:instance_eval</span><span class="p">,</span> <span class="ss">:instance_exec</span><span class="p">,</span> <span class="ss">:__send__</span><span class="p">,</span> <span class="ss">:__id__</span><span class="p">]</span>
</code></pre>
</div>

<p>其中:</p>

<ul>
  <li>冒号: 用冒号+字符串代表Symbol(名字), 表示创建了一个Symbol对象, 常用于表示方法, 可以参考<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-rubysbl/index.html">这里</a></li>
  <li>问号: 问号也是方法名的一部分,表示这个方法,返回true或者false</li>
  <li>叹号: 叹号也是方法名的一部分,表示这个方法,与同名的方法(如gsub,gsub!)功能类似,但此方法会改变对象的内部属性, 相反, 另一个方法则不会修改</li>
  <li>下划线: 如__send__, __id__, 为特殊命名方式, 因send太常见,可能被覆盖,用__send__可避免</li>
</ul>

<h2 id="section-3">字符串操作</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">## 简单</span>
<span class="s1">'hello'</span><span class="p">.</span><span class="nf">length</span>   <span class="c1">## 5</span>
<span class="s1">'hello'</span><span class="p">.</span><span class="nf">start_with?</span><span class="p">(</span><span class="s1">'he'</span><span class="p">)</span>   <span class="c1">## true</span>
<span class="s1">'hello'</span><span class="p">.</span><span class="nf">end_with?</span><span class="p">(</span><span class="s1">'he'</span><span class="p">)</span>     <span class="c1">## false</span>
<span class="s1">' hello '</span><span class="p">.</span><span class="nf">strip</span>             <span class="c1">## 'hello'</span>

<span class="c1"># 字符串连接</span>
<span class="s1">'hello '</span> <span class="o">+</span> <span class="s1">'world '</span> <span class="o">+</span> <span class="mi">3</span><span class="p">.</span><span class="nf">to_s</span>  <span class="c1">## 'hello world 3'</span>

<span class="c1"># 子字符串</span>
<span class="s1">'hello world'</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>     <span class="c1">## 'l'</span>
<span class="s1">'hello world'</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>   <span class="c1">## 'lo wo'</span>
<span class="s1">'hello world'</span><span class="p">[</span><span class="mi">3</span><span class="p">.</span><span class="nf">.</span><span class="mi">5</span><span class="p">]</span>  <span class="c1">## 'lo '</span>

<span class="c1"># 查找</span>
<span class="s1">'hello world'</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="s1">'orl'</span><span class="p">)</span>   <span class="c1">## 7</span>
<span class="s1">'hello world'</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="sr">/[ole]+/</span><span class="p">)</span>  <span class="c1">## 1</span>

<span class="c1"># 替换</span>
<span class="s1">'hello world'</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'o'</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">)</span>  <span class="c1">## 'helle werld'</span>
<span class="s1">'hello world'</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/[a-z]+/</span><span class="p">,</span> <span class="s1">'ok'</span><span class="p">)</span>   <span class="c1">## 'ok ok'</span>

<span class="c1"># 分拆</span>
<span class="s1">'hello world'</span><span class="p">.</span><span class="nf">lines</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>     <span class="c1">## ["hello ", "world"]</span>
<span class="s2">" now's  the time"</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>   <span class="c1">#=&gt; ["now's", "the", "time"]</span>
<span class="s2">"hello"</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span>               <span class="c1">#=&gt; ["h", "e", "l", "l", "o"]</span>

</code></pre>
</div>

<h2 id="section-4">数组操作</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'two'</span><span class="p">,</span><span class="s1">'three'</span><span class="p">].</span><span class="nf">length</span>    <span class="c1">## 3</span>
<span class="p">[</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'two'</span><span class="p">,</span><span class="s1">'three'</span><span class="p">].</span><span class="nf">include?</span><span class="p">(</span><span class="s1">'four'</span><span class="p">)</span>   <span class="c1">## false</span>
<span class="p">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'2'</span><span class="p">,</span><span class="s1">'3'</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s1">'4'</span>            <span class="c1">## ['1','2','3','4']</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">.</span><span class="nf">.</span><span class="mi">3</span><span class="p">]</span>                 <span class="c1">## [2,3]</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">].</span><span class="nf">sort</span>					<span class="c1">## [1,2,3,4]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">].</span><span class="nf">uniq</span>					<span class="c1">## [1,3,4]</span>
<span class="p">[</span><span class="s1">'one'</span><span class="p">,</span><span class="s1">'two'</span><span class="p">,</span><span class="s1">'three'</span><span class="p">].</span><span class="nf">join</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span> <span class="c1">## 'one,two,three'</span>

</code></pre>
</div>

<h2 id="section-5">函数</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>def process

end
</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013-12-31-iteye-blog-migration.html">iteye 博客迁移</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-12-31T15:16:16+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>之前一直是在iteye上写博客的, 后来建立了本博客系统后, 就希望将博客从iteye上迁移过来</p>

<p>然而iteye上博客的文章太多了, 手动一篇一篇拷贝很不现实, 所以写了个工具来辅助迁移</p>

<p>iteye2markdown是一款博客迁移工具,可以将博客从iteye迁移至octopress</p>

<ul>
  <li>此工具会自动下载iteye博客上的所有文章</li>
  <li>接着会将博客中的bbcode代码转换成markdown</li>
  <li>下载转换后的markdown可用于octopress,迁移至自己的博客系统上</li>
</ul>

<!--more-->

<p>使用方式:</p>

<ul>
  <li>修改download.rb中的cookie配置, cookie将用于连接iteye.com的后台系统, 下载博客内容</li>
  <li>修改download.rb中的博客地址</li>
  <li>使用以下命令
<code class="highlighter-rouge">
ruby download.rb
</code>
执行下载转换, 结果保存于blog目录中</li>
</ul>

<p>源代码见:  <a href="https://github.com/seavers/iteye2markdown">github</a></p>

<p>核心代码如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>re 'open-uri'
require 'nokogiri'

def process(id, date)
	host = 'http://seavers.iteye.com'
	cookie = ''      #IO.read('cookie.txt')
	agent = 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.14 Safari/537.36'

	html = open(host + '/admin/blogs/' + id + '/edit', 'User-Agent'=&gt;agent, 'Cookie'=&gt;cookie).read
	doc = Nokogiri::HTML(html)

	title = doc.search('#blog_title').attr('value').to_s
	text = doc.search('#editor_body').text
	category = doc.search('#blog_category_list').attr('value').to_s
	tag = doc.search('#blog_tag_list').attr('value').to_s
	

	content = text
		.gsub('[size=xx-large]', '#')
		.gsub('[size=x-large]', '##')
		.gsub('[size=large]', '###')
		.gsub('[size=medium]', '####')
		.gsub('[size=small]', '')
		.gsub('[size=x-small]', '')
		.gsub('[size=xx-small]', '')
		.gsub('[/size]', '')
		.gsub(/\[url=(.*)\](.*)\[\/url\]/, '[\2](\1)')
		.gsub('[url]', '').gsub('[/url]', '')
		.gsub('[b]', '*').gsub('[/b]', '*')
		.gsub('[list]', '').gsub('[/list]', '')
		.gsub('[b]', '*').gsub('[/b]', '*')
		.gsub('[*]', '* ')
		.gsub('[code]', '```').gsub('[ne/code]', '```')
		.gsub(/\[code="(.*)"\]/, '```')


	filename = date[0..9] + '-' + id + '.markdown'
	File.open('blog/' + filename, 'w') { |file|
		file.puts '---'
		file.puts 'layout: post'
		file.puts 'title: "' + title.to_s + '"'
		file.puts 'date: ' + date + ':00 +0800'
		file.puts 'comments: true'
		file.puts 'categories:'
		file.puts '- ' + category.to_s
		file.puts 'tags:'
		tag.split(',').each {|x|
			file.puts '- ' + x
		}
		file.puts '---'

		file.puts ''
		file.puts content 
	}

end

def spider(page)
	agent = 'Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.14 Safari/537.36'

	url = 'http://seavers.iteye.com/?page='+page.to_s
	html = open(url, 'User-Agent'=&gt;agent)

	doc = Nokogiri::HTML(html)
	doc.search('.blog_main').each {|x|
		id = x.search('h3 a').attr('href').text[/[0-9]+/, 0]
		date = x.search('.blog_bottom .date').text
		puts id + "\t" + date
		process(id, date)
	}

	return doc.search('.pagination a.next_page').length == 0
end

##process('1416013', '2013-12-31 14:01')
(1..100).each {|page|
	break if spider(page)
}

</code></pre>
</div>

</div>
  
  


    </article>
  
    
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013-12-23-ruby-spider.html">ruby spider</a></h1>
    
    
      <p class="meta">
        









<time datetime="2013-12-23T21:19:09+08:00" pubdate data-updated="true"></time>
      </p>
    
  </header>


  <div class="entry-content"><p>最近开始喜欢上研究ruby了,正好手头有一些抓取的需求,正好练练手</p>

<p>在写爬虫时,我们总希望能方便的实现以下功能</p>

<ul>
  <li>类似curl的下载模块,提供URL即可获取下载内容</li>
  <li>方便的网页分析工具,最好能提供类似css selector的元素选择器</li>
  <li>简单方便的数据处理模块</li>
</ul>

<!--more-->

<p>写个简单的例子</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#encoding:utf-8
require 'open-uri'
require 'nokogiri'

def spide
    url = "http://home.photo.qq.com/index.php?mod=activity&amp;act=detail&amp;category_id=1"

    html = open(url).read
    doc = Nokogiri::HTML(html)

    list = doc.search('.photo-list li img')
    list.each { |x|
        src = x.attr('src')
        puts src.gsub(/400/, '800');
    }
end

spide

</code></pre>
</div>

<p>其中:</p>

<ol>
  <li>open-uri模块用于实现curl的功能, open后read即可</li>
  <li>Nokogiri为html分析模块,支持css selector式的元素选择</li>
  <li>而ruby本身的特点, 则可快速处理数据</li>
</ol>

<p>抓到图片URL后,剩下的就容易多了,都下载下来吧~~</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    
	
        <li class='category'><a href="/blog/categories/windows/">windows (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/java/">java (9)</a></li>
    
	
        <li class='category'><a href="/blog/categories/game/">game (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/思考/">思考 (9)</a></li>
    
	
        <li class='category'><a href="/blog/categories/ubuntu/">ubuntu (20)</a></li>
    
	
        <li class='category'><a href="/blog/categories/php/">php (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/javascript/">javascript (10)</a></li>
    
	
        <li class='category'><a href="/blog/categories/css/">css (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/maven/">maven (6)</a></li>
    
	
        <li class='category'><a href="/blog/categories/git/">git (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/cubieboard/">cubieboard (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/android/">android (2)</a></li>
    
	
        <li class='category'><a href="/blog/categories/nginx/">nginx (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/octopress/">octopress (3)</a></li>
    
	
        <li class='category'><a href="/blog/categories/html5/">html5 (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/hive/">hive (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/chrome/">chrome (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/ruby/">ruby (5)</a></li>
    
	
        <li class='category'><a href="/blog/categories/mybatis/">mybatis (1)</a></li>
    
	
        <li class='category'><a href="/blog/categories/jekyll/">jekyll (1)</a></li>
    
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018-09-18-maven-archetype-multimodule.html">maven构建archetype多模块工程模板的问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016-02-12-java-native-list.html">java native方法列表</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016-02-07-jekyll-update.html">升级jekyll</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-11-25-mybatis-dong-tai-sao-miao-xml.html">mybatis 动态扫描xml</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014-01-19-ruby-multiple-return.html">ruby语法糖 - 多返回值</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>大牛博客</h1>
  <ul>
    <li>
      <a href="http://ithans.com/">ithans</a>
    </li>
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - lianghaijun -
  <span class="credit">Powered by <a target="_blank" href="http://jekyllrb.com">jekyll</a></span>
</p>
</footer>
  <script src="/blog/static/jquery.min.js"></script>
<script src="/blog/static/blog.js?tag=20160209"></script>
<script src='http://hm.baidu.com/h.js?f1e7ae48ee023d8ed983af30c485b5ce'></script>


</body>
</html>
